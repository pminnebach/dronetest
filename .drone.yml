pipeline:
  build:
    image: golang:${GO_VERSION}
    environment:
      - GOOS=${GO_OS}
      - GOARCH=${GO_ARCH}
    commands:
      - pwd
      - ls -al
      - go get golang.org/x/sys/windows/registry
      - pwd
      - ls -al
      - go build -o ./release/WindowsVersion-$GOOS-$GOARCH-$GO_VERSION.exe
      - pwd
      - ls -al
      - ls -al release/
      
  rebuild-cache:
    image: drillster/drone-volume-cache
    rebuild: true
    mount:
      - release
    volumes:
      - /home/pminnebach/docker/release:/cache/pminnebach/dronetest

  artifactory:
    image: athieriot/drone-artifactory
    url: ${art_url}
    username: ${art_user}
    password: ${art_pass}
    group_id: com.company
    artifact_id: awesome-lib
    version: 1.0-SNAPSHOT
    files:
      - WindowsVersion-$GOOS-$GOARCH-$GO_VERSION.exe

matrix:
  GO_VERSION:
    - 1.8
    - 1.7
    - latest
  GO_ARCH:
    - 386
    - amd64
  GO_OS:
    - windows

